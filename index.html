<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MILOCOSTUDIO | Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #ffffff; --card: rgba(74, 74, 74, 0.9); --text: #ffffff;
            --input-bg: rgba(43, 43, 43, 0.8); --overlay: rgba(0,0,0,0.85);
        }

        body { margin: 0; background: #000; color: var(--text); font-family: 'Montserrat', sans-serif; min-height: 100vh; overflow-x: hidden; padding: 20px; box-sizing: border-box; }
        
        /* Fondo idéntico al de reservas */
        .bg-fixed { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.7)), url('199797.jpg'); background-size: cover; background-position: center; z-index: -1; }

        .container { max-width: 600px; margin: 40px auto; position: relative; z-index: 10; }
        
        h2 { text-align: center; letter-spacing: 5px; font-weight: 300; margin-bottom: 30px; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }

        .card { background: var(--card); padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .btn-del { position: absolute; top: 10px; right: 10px; background: #ff4d4d; border: none; color: white; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; }
        .tab { flex: 1; padding: 12px; text-align: center; background: rgba(255,255,255,0.1); cursor: pointer; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); transition: 0.3s; letter-spacing: 2px; font-size: 0.8rem; }
        .tab.active { background: white; color: black; font-weight: bold; }

        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: var(--input-bg); color: white; box-sizing: border-box; }
        
        .btn-wa { display: block; background: #25d366; color: white; text-decoration: none; text-align: center; padding: 12px; border-radius: 8px; margin-top: 10px; font-weight: bold; letter-spacing: 1px; }
        
        .flex-row { display: flex; gap: 8px; align-items: center; }
        .btn-add-cat { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 12px; border-radius: 8px; cursor: pointer; white-space: nowrap; font-size: 0.8rem; }

        .btn-main { width: 100%; padding: 15px; background: white; color: black; font-weight: bold; border: none; border-radius: 8px; margin-top: 10px; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

<div class="bg-fixed"></div>

<div class="container">
    <h2>ADMIN MILOCOSTUDIO</h2>
    
    <div class="tabs">
        <div class="tab active" onclick="switchTab('agenda')">AGENDA</div>
        <div class="tab" onclick="switchTab('catalogo')">CATÁLOGO</div>
    </div>

    <div id="panelAgenda">
        <input type="date" id="filtroFecha">
        <div id="listaAgenda"></div>
    </div>

    <div id="panelCatalogo" style="display:none">
        <div class="card">
            <h4 style="margin:0 0 10px 0; letter-spacing: 2px; font-weight: 400;">NUEVO SERVICIO</h4>
            <input id="sNom" placeholder="Nombre del Servicio">
            <input id="sPre" type="number" placeholder="Precio ($)">
            
            <div class="flex-row">
                <select id="sCat">
                    <option value="CORTES">CORTES</option>
                    <option value="BARBA">BARBA</option>
                    <option value="DETALLES">DETALLES</option>
                    <option value="COLORES">COLORES</option>
                </select>
                <button class="btn-add-cat" onclick="nuevaCategoria()">+ SECCIÓN</button>
            </div>

            <button onclick="guardarServicio()" class="btn-main">Añadir al Menú</button>
        </div>
        <div id="listaCat"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, query, orderByChild, equalTo, remove, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCb47oi5HqrgrqIc1jwukF-igINVSOm5Pk",
        authDomain: "milocostudio-a1528.firebaseapp.com",
        databaseURL: "https://milocostudio-a1528-default-rtdb.firebaseio.com",
        projectId: "milocostudio-a1528"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let currentUnsub = null;

    const inputF = document.getElementById('filtroFecha');
    inputF.value = new Date().toISOString().split('T')[0];
    inputF.onchange = () => cargarAgenda();

    window.switchTab = t => {
        document.getElementById('panelAgenda').style.display = t === 'agenda' ? 'block' : 'none';
        document.getElementById('panelCatalogo').style.display = t === 'catalogo' ? 'block' : 'none';
        document.querySelectorAll('.tab').forEach(el => el.classList.toggle('active', el.innerText.toLowerCase().includes(t.toLowerCase())));
        if(t==='catalogo') cargarCat(); else cargarAgenda();
    };

    function cargarAgenda() {
        if(currentUnsub) currentUnsub();
        const q = query(ref(db, 'reservas'), orderByChild('fecha'), equalTo(inputF.value));
        currentUnsub = onValue(q, snap => {
            const cont = document.getElementById('listaAgenda');
            cont.innerHTML = "";
            if(!snap.exists()) return cont.innerHTML = "<p style='text-align:center; opacity:0.5;'>Sin turnos para esta fecha.</p>";
            Object.entries(snap.val()).sort((a,b) => a[1].hora.localeCompare(b[1].hora)).forEach(([id, r]) => {
                const d = document.createElement('div'); d.className = 'card';
                d.style.borderLeft = "5px solid #25d366";
                d.innerHTML = `<button class="btn-del" onclick="borrar('${id}')">X</button>
                    <b style="font-size:1.1rem;">${r.hora} hs</b> - ${r.nombre}<br>
                    <small style="opacity:0.8">${r.servicio}</small>
                    <a href="https://wa.me/${r.tel.replace(/\D/g,'')}" class="btn-wa" target="_blank">HABLAR POR WHATSAPP</a>`;
                cont.appendChild(d);
            });
        });
    }

    window.borrar = id => confirm("¿Deseas eliminar esta reserva?") && remove(ref(db, `reservas/${id}`));

    function cargarCat() {
        onValue(ref(db, 'catalogo'), snap => {
            const cont = document.getElementById('listaCat'); cont.innerHTML = "";
            if(snap.exists()) {
                Object.entries(snap.val()).forEach(([id, s]) => {
                    const d = document.createElement('div'); d.className = 'card';
                    d.innerHTML = `<b>${s.nombre}</b> - $${s.precio} <br> 
                                   <small style="color: #ccc; text-transform: uppercase; font-size:0.7rem; letter-spacing:1px;">Sección: ${s.categoria || 'Sin categoría'}</small>
                                   <button class="btn-del" onclick="borrarCat('${id}')">X</button>`;
                    cont.appendChild(d);
                });
            }
        });
    }

    window.nuevaCategoria = () => {
        const nombre = prompt("Nombre de la nueva sección:");
        if (nombre) {
            const sel = document.getElementById('sCat');
            const opt = document.createElement('option');
            opt.value = nombre.toUpperCase();
            opt.innerText = nombre.toUpperCase();
            sel.appendChild(opt);
            sel.value = opt.value;
        }
    };

    window.guardarServicio = () => {
        const n = document.getElementById('sNom').value;
        const p = document.getElementById('sPre').value;
        const c = document.getElementById('sCat').value;
        if(n && p && c) {
            push(ref(db, 'catalogo'), {nombre: n, precio: p, categoria: c});
            document.getElementById('sNom').value = "";
            document.getElementById('sPre').value = "";
        } else {
            alert("Por favor, completa nombre y precio.");
        }
    };

    window.borrarCat = id => confirm("¿Eliminar este servicio del catálogo?") && remove(ref(db, `catalogo/${id}`));
    
    cargarAgenda();
</script>
</body>
</html>
